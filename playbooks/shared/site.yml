---
# Master playbook - orchestrates all deployments
# Usage: ansible-playbook playbooks/shared/site.yml -i inventories/<env>/<compartment>/hosts.yml

- name: Site-wide deployment - Pre-flight
  hosts: all
  become: true
  gather_facts: true
  tasks:
    - name: Display deployment information
      ansible.builtin.debug:
        msg: |
          Starting site deployment
          Environment: {{ env | default('unknown') }}
          Inventory: {{ inventory_file }}
          Date: {{ ansible_date_time.iso8601 }}

# Import provisioning playbook
- name: Import provisioning
  ansible.builtin.import_playbook: provision.yml
  when: provision | default(false) | bool

# Import configuration playbook
- name: Import configuration
  ansible.builtin.import_playbook: configure.yml

# Import validation playbook
- name: Import validation
  ansible.builtin.import_playbook: validate.yml
  when: validate | default(true) | bool

- name: Site-wide deployment - Summary
  hosts: all
  become: true
  gather_facts: false
  tasks:
    - name: Deployment summary
      ansible.builtin.debug:
        msg: "Site deployment completed successfully"
