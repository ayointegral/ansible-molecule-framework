---
# defaults/main.yml - Default variables for PostgreSQL role

# Package management
postgresql_version: 15
postgresql_package_state: present

# Service management
postgresql_service_state: started
postgresql_service_enabled: true

# Installation source
postgresql_use_official_repo: true

# PostgreSQL directories
postgresql_data_dir: "/var/lib/postgresql/{{ postgresql_version }}/main"
postgresql_config_dir: "/etc/postgresql/{{ postgresql_version }}/main"
postgresql_log_dir: /var/log/postgresql

# Connection settings
postgresql_listen_addresses: "localhost"
postgresql_port: 5432
postgresql_max_connections: 100
postgresql_superuser_reserved_connections: 3

# Memory settings
postgresql_shared_buffers: "128MB"
postgresql_effective_cache_size: "512MB"
postgresql_work_mem: "4MB"
postgresql_maintenance_work_mem: "64MB"

# WAL settings
postgresql_wal_level: replica
postgresql_max_wal_size: "1GB"
postgresql_min_wal_size: "80MB"
postgresql_wal_buffers: "16MB"

# Checkpoint settings
postgresql_checkpoint_completion_target: 0.9
postgresql_checkpoint_timeout: "5min"

# Logging settings
postgresql_log_destination: stderr
postgresql_logging_collector: true
postgresql_log_directory: pg_log
postgresql_log_filename: "postgresql-%Y-%m-%d_%H%M%S.log"
postgresql_log_rotation_age: "1d"
postgresql_log_rotation_size: "100MB"
postgresql_log_min_duration_statement: 1000
postgresql_log_checkpoints: true
postgresql_log_connections: false
postgresql_log_disconnections: false
postgresql_log_lock_waits: true
postgresql_log_temp_files: 0
postgresql_log_timezone: UTC

# Security settings
postgresql_password_encryption: scram-sha-256
postgresql_ssl: false
postgresql_ssl_cert_file: /etc/ssl/certs/ssl-cert-snakeoil.pem
postgresql_ssl_key_file: /etc/ssl/private/ssl-cert-snakeoil.key

# pg_hba.conf entries
postgresql_hba_entries:
  - type: local
    database: all
    user: postgres
    method: peer
  - type: local
    database: all
    user: all
    method: peer
  - type: host
    database: all
    user: all
    address: "127.0.0.1/32"
    method: scram-sha-256
  - type: host
    database: all
    user: all
    address: "::1/128"
    method: scram-sha-256

# Databases to create
postgresql_databases: []
# Example:
# postgresql_databases:
#   - name: myapp
#     owner: myapp_user
#     encoding: UTF8
#     lc_collate: en_US.UTF-8
#     lc_ctype: en_US.UTF-8
#     template: template0

# Users to create
postgresql_users: []
# Example:
# postgresql_users:
#   - name: myapp_user
#     password: "securepassword"
#     role_attr_flags: CREATEDB,LOGIN
#     priv: ALL
#     db: myapp

# Extensions to install
postgresql_extensions: []
# Example:
# postgresql_extensions:
#   - name: pg_stat_statements
#     db: postgres
#   - name: uuid-ossp
#     db: myapp

# Backup settings
postgresql_backup_enabled: false
postgresql_backup_dir: /var/backups/postgresql
postgresql_backup_schedule: "0 2 * * *"
postgresql_backup_retention_days: 7
