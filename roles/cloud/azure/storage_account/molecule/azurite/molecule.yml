---
# Azurite scenario - Free Microsoft Azure Storage Emulator
# Tests Azure Storage SDK operations against Azurite sidecar
dependency:
  name: galaxy
driver:
  name: docker
platforms:
  # Main test instance
  - name: azure-test-instance
    image: geerlingguy/docker-ubuntu2204-ansible:latest
    pre_build_image: true
    privileged: true
    command: /sbin/init
    tmpfs:
      - /run
      - /tmp
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
    cgroupns_mode: host
    networks:
      - name: azurite-network

  # Azurite sidecar - Official Microsoft Azure Storage Emulator
  - name: azurite
    image: mcr.microsoft.com/azure-storage/azurite:latest
    pre_build_image: true
    command: "azurite --blobHost 0.0.0.0 --queueHost 0.0.0.0 --tableHost 0.0.0.0 --loose --skipApiVersionCheck"
    exposed_ports:
      - 10000/tcp
      - 10001/tcp
      - 10002/tcp
    networks:
      - name: azurite-network

provisioner:
  name: ansible
  env:
    ANSIBLE_ALLOW_BROKEN_CONDITIONALS: "true"
  inventory:
    hosts:
      all:
        hosts:
          azure-test-instance:
            ansible_connection: docker

verifier:
  name: ansible
